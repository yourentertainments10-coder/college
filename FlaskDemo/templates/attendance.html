{% extends "base.html" %}

{% block title %}Attendance - DSEU{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Left Sidebar -->
        <nav class="col-md-3 col-lg-2 sidebar bg-light p-3">
            <div class="sidebar-sticky">
                <div class="text-center mb-4">
                    <i class="fas fa-calendar-check fa-4x text-primary"></i>
                    <h5 class="mt-2">{{ session.user }}</h5>
                    <p class="text-muted">Student</p>
                </div>
                <div class="list-group">
                    <a href="{{ url_for('student_portal') }}" class="list-group-item list-group-item-action">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    <a href="#overview" class="list-group-item list-group-item-action">
                        <i class="fas fa-chart-pie"></i> Overview
                    </a>
                    <a href="#subject-wise" class="list-group-item list-group-item-action">
                        <i class="fas fa-book"></i> Subject-wise
                    </a>
                    <a href="#monthly" class="list-group-item list-group-item-action">
                        <i class="fas fa-calendar-alt"></i> Monthly View
                    </a>
                    <a href="{{ url_for('logout') }}" class="list-group-item list-group-item-action text-danger">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </a>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="col-md-9 col-lg-10 px-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Attendance Record</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <button type="button" class="btn btn-sm btn-outline-primary mr-2">
                        <i class="fas fa-download"></i> Download Report
                    </button>
                </div>
            </div>

            <!-- Overall Attendance -->
            <section id="overview" class="mb-5 animate-on-scroll">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h3 class="mb-0">Overall Attendance</h3>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="attendance-chart">
                                    <!-- Add a circular progress chart here -->
                                    <div class="progress-circle">
                                        <h2 class="text-center">85%</h2>
                                        <p class="text-center text-muted">Present</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="attendance-stats">
                                    <h4>Summary</h4>
                                    <ul class="list-unstyled">
                                        <li><i class="fas fa-check-circle text-success mr-2"></i>Total Classes: 120</li>
                                        <li><i class="fas fa-user-check text-primary mr-2"></i>Classes Attended: 102</li>
                                        <li><i class="fas fa-user-times text-danger mr-2"></i>Classes Missed: 18</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Subject-wise Attendance -->
            <section id="subject-wise" class="mb-5 animate-on-scroll">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h3 class="mb-0">Subject-wise Attendance</h3>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Subject</th>
                                        <th>Total Classes</th>
                                        <th>Attended</th>
                                        <th>Percentage</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Computer Networks</td>
                                        <td>30</td>
                                        <td>27</td>
                                        <td>90%</td>
                                        <td><span class="badge badge-success">Good</span></td>
                                    </tr>
                                    <tr>
                                        <td>Database Management</td>
                                        <td>25</td>
                                        <td>20</td>
                                        <td>80%</td>
                                        <td><span class="badge badge-warning">Average</span></td>
                                    </tr>
                                    <!-- Add more subjects -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Monthly View -->
            <section id="monthly" class="mb-5 animate-on-scroll">
                <div class="card">
                    <div class="card-header bg-info text-white d-flex justify-content-between align-items-center">
                        <h3 class="mb-0">Monthly Attendance</h3>
                        <div class="d-flex align-items-center">
                            <select class="form-control form-control-sm mr-2">
                                <option>Select Month</option>
                                <option>January 2024</option>
                                <option>February 2024</option>
                                <option selected>March 2024</option>
                            </select>
                            <select class="form-control form-control-sm">
                                <option>Select Subject</option>
                                <option>All Subjects</option>
                                <option>Computer Networks</option>
                                <option>Database Systems</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="calendar-wrapper">
                            <div class="calendar-grid">
                                <div class="calendar-header">
                                    <div>Sun</div>
                                    <div>Mon</div>
                                    <div>Tue</div>
                                    <div>Wed</div>
                                    <div>Thu</div>
                                    <div>Fri</div>
                                    <div>Sat</div>
                                </div>
                                <div class="calendar-days">
                                    <!-- Calendar days will be dynamically populated -->
                                </div>
                            </div>
                            <div class="attendance-legend mt-3">
                                <div class="d-flex justify-content-center">
                                    <div class="legend-item mr-4">
                                        <span class="badge badge-success">P</span>
                                        <small>Present</small>
                                    </div>
                                    <div class="legend-item mr-4">
                                        <span class="badge badge-danger">A</span>
                                        <small>Absent</small>
                                    </div>
                                    <div class="legend-item">
                                        <span class="badge badge-warning">H</span>
                                        <small>Holiday</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .progress-circle {
        width: 200px;
        height: 200px;
        border-radius: 50%;
        background: conic-gradient(#28a745 85%, #dc3545 0);
        margin: 20px auto;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .progress-circle::before {
        content: '';
        position: absolute;
        width: 160px;
        height: 160px;
        background: white;
        border-radius: 50%;
    }

    .progress-circle h2 {
        position: relative;
        z-index: 1;
        margin: 0;
    }

    .attendance-stats {
        padding: 20px;
    }

    .attendance-stats li {
        margin-bottom: 15px;
        font-size: 1.1em;
    }

    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
        padding: 10px;
    }

    .badge {
        padding: 8px 12px;
        border-radius: 20px;
    }

    @media (max-width: 768px) {
        .progress-circle {
            width: 150px;
            height: 150px;
        }

        .progress-circle::before {
            width: 120px;
            height: 120px;
        }
    }

    /* Calendar Styles */
    .calendar-wrapper {
        padding: 1rem;
    }

    .calendar-grid {
        display: flex;
        flex-direction: column;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        overflow: hidden;
    }

    .calendar-header {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        background: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
    }

    .calendar-header div {
        padding: 10px;
        text-align: center;
        font-weight: 600;
    }

    .calendar-days {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background: #dee2e6;
    }

    .calendar-day {
        background: white;
        padding: 10px;
        min-height: 80px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .calendar-day .date {
        font-weight: 500;
        margin-bottom: 5px;
    }

    .calendar-day .status {
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        font-size: 0.8rem;
        color: white;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .legend-item .badge {
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
    }

    /* Mobile Responsive Adjustments */
    @media (max-width: 768px) {
        .calendar-header div {
            padding: 5px;
            font-size: 0.8rem;
        }

        .calendar-day {
            min-height: 60px;
            padding: 5px;
        }

        .calendar-day .date {
            font-size: 0.8rem;
        }

        .calendar-day .status {
            width: 25px;
            height: 25px;
            font-size: 0.7rem;
        }

        .form-control-sm {
            font-size: 0.8rem;
            height: 35px;
            padding: 0.25rem 0.5rem;
        }

        .card-header {
            flex-direction: column;
            gap: 10px;
        }

        .card-header .d-flex {
            width: 100%;
            flex-direction: column;
            gap: 10px;
        }

        .form-control-sm {
            width: 100%;
            margin-right: 0 !important;
        }
    }

    /* Tablet Adjustments */
    @media (min-width: 769px) and (max-width: 991px) {
        .calendar-day {
            min-height: 70px;
        }
    }
</style>
{% endblock %}

<script>
    // Function to populate calendar
    function populateCalendar(month, year) {
        const daysContainer = document.querySelector('.calendar-days');
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const totalDays = lastDay.getDate();
        const startingDay = firstDay.getDay();

        let calendarHTML = '';

        // Add empty cells for days before the first day of the month
        for (let i = 0; i < startingDay; i++) {
            calendarHTML += '<div class="calendar-day"></div>';
        }

        // Add days of the month
        for (let day = 1; day <= totalDays; day++) {
            const status = getRandomStatus(); // Replace with actual attendance data
            calendarHTML += `
                <div class="calendar-day">
                    <span class="date">${day}</span>
                    <span class="status badge badge-${status.color}">${status.label}</span>
                </div>
            `;
        }

        daysContainer.innerHTML = calendarHTML;
    }

    // Helper function to simulate random attendance status
    function getRandomStatus() {
        const statuses = [
            { label: 'P', color: 'success' },
            { label: 'A', color: 'danger' },
            { label: 'H', color: 'warning' }
        ];
        return statuses[Math.floor(Math.random() * 3)];
    }

    // Initialize calendar
    document.addEventListener('DOMContentLoaded', () => {
        populateCalendar(2, 2024); // March 2024
    });
</script> 